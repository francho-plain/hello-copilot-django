services:
  cats_postgres:
    build: 
      context: .
      dockerfile: Dockerfile
    container_name: ${POSTGRES_CONTAINER_NAME:-cats_database}
    env_file:
      - .env
    environment:
      # Core PostgreSQL settings
      POSTGRES_DB: ${POSTGRES_DB}
      POSTGRES_USER: ${POSTGRES_USER}
      POSTGRES_PASSWORD: ${POSTGRES_PASSWORD}
      POSTGRES_INITDB_ARGS: ${POSTGRES_INITDB_ARGS:---encoding=UTF-8}
      
      # Advanced settings
      POSTGRES_MAX_CONNECTIONS: ${POSTGRES_MAX_CONNECTIONS:-100}
      POSTGRES_SHARED_BUFFERS: ${POSTGRES_SHARED_BUFFERS:-256MB}
      
      # Application environment
      ENVIRONMENT: ${ENVIRONMENT:-development}
      POSTGRES_HOST: ${POSTGRES_HOST:-localhost}
      POSTGRES_PORT: ${POSTGRES_PORT:-5432}
    ports:
      - "${POSTGRES_PORT:-5432}:5432"
    volumes:
      - ${POSTGRES_VOLUME_NAME:-cats_data}:/var/lib/postgresql/data
      - ./create-data.sql:/docker-entrypoint-initdb.d/create-data.sql:ro
      - ./init-env.sh:/docker-entrypoint-initdb.d/00-init-env.sh:ro
    networks:
      - cats_network
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U ${POSTGRES_USER:-cats_user} -d ${POSTGRES_DB:-cats_db}"]
      interval: ${POSTGRES_HEALTH_CHECK_INTERVAL:-30s}
      timeout: ${POSTGRES_HEALTH_CHECK_TIMEOUT:-10s}
      retries: ${POSTGRES_HEALTH_CHECK_RETRIES:-3}

volumes:
  cats_data:
    driver: local
  cats_dev_data:
    driver: local
  cats_test_data:
    driver: local

networks:
  cats_network:
    driver: bridge